{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { useMemo, useState } from 'react';\nimport useEventListener from '../useEventListener';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useRequest from '../useRequest';\nimport useUpdateEffect from '../useUpdateEffect';\nimport { getTargetElement } from '../utils/domTarget';\nimport { getClientHeight, getScrollHeight, getScrollTop } from '../utils/rect';\nconst useInfiniteScroll = function (service) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const {\n    target,\n    isNoMore,\n    threshold = 100,\n    reloadDeps = [],\n    manual,\n    onBefore,\n    onSuccess,\n    onError,\n    onFinally\n  } = options;\n  const [finalData, setFinalData] = useState();\n  const [loadingMore, setLoadingMore] = useState(false);\n  const noMore = useMemo(() => {\n    if (!isNoMore) return false;\n    return isNoMore(finalData);\n  }, [finalData]);\n  const {\n    loading,\n    run,\n    runAsync,\n    cancel\n  } = useRequest(lastData => __awaiter(void 0, void 0, void 0, function* () {\n    const currentData = yield service(lastData);\n    if (!lastData) {\n      setFinalData(currentData);\n    } else {\n      setFinalData(Object.assign(Object.assign({}, currentData), {\n        // @ts-ignore\n        list: [...lastData.list, ...currentData.list]\n      }));\n    }\n    return currentData;\n  }), {\n    manual,\n    onFinally: (_, d, e) => {\n      setLoadingMore(false);\n      onFinally === null || onFinally === void 0 ? void 0 : onFinally(d, e);\n    },\n    onBefore: () => onBefore === null || onBefore === void 0 ? void 0 : onBefore(),\n    onSuccess: d => {\n      setTimeout(() => {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        scrollMethod();\n      });\n      onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(d);\n    },\n    onError: e => onError === null || onError === void 0 ? void 0 : onError(e)\n  });\n  const loadMore = () => {\n    if (noMore) return;\n    setLoadingMore(true);\n    run(finalData);\n  };\n  const loadMoreAsync = () => {\n    if (noMore) return Promise.reject();\n    setLoadingMore(true);\n    return runAsync(finalData);\n  };\n  const reload = () => run();\n  const reloadAsync = () => runAsync();\n  const scrollMethod = () => {\n    const el = getTargetElement(target);\n    if (!el) {\n      return;\n    }\n    const scrollTop = getScrollTop(el);\n    const scrollHeight = getScrollHeight(el);\n    const clientHeight = getClientHeight(el);\n    if (scrollHeight - scrollTop <= clientHeight + threshold) {\n      loadMore();\n    }\n  };\n  useEventListener('scroll', () => {\n    if (loading || loadingMore) {\n      return;\n    }\n    scrollMethod();\n  }, {\n    target\n  });\n  useUpdateEffect(() => {\n    run();\n  }, [...reloadDeps]);\n  return {\n    data: finalData,\n    loading: !loadingMore && loading,\n    loadingMore,\n    noMore,\n    loadMore: useMemoizedFn(loadMore),\n    loadMoreAsync: useMemoizedFn(loadMoreAsync),\n    reload: useMemoizedFn(reload),\n    reloadAsync: useMemoizedFn(reloadAsync),\n    mutate: setFinalData,\n    cancel\n  };\n};\nexport default useInfiniteScroll;","map":{"version":3,"names":["__awaiter","useMemo","useState","useEventListener","useMemoizedFn","useRequest","useUpdateEffect","getTargetElement","getClientHeight","getScrollHeight","getScrollTop","useInfiniteScroll","service","options","arguments","length","undefined","target","isNoMore","threshold","reloadDeps","manual","onBefore","onSuccess","onError","onFinally","finalData","setFinalData","loadingMore","setLoadingMore","noMore","loading","run","runAsync","cancel","lastData","currentData","Object","assign","list","_","d","e","setTimeout","scrollMethod","loadMore","loadMoreAsync","Promise","reject","reload","reloadAsync","el","scrollTop","scrollHeight","clientHeight","data","mutate"],"sources":["/Users/mac/node_modules/ahooks/es/useInfiniteScroll/index.js"],"sourcesContent":["import { __awaiter } from \"tslib\";\nimport { useMemo, useState } from 'react';\nimport useEventListener from '../useEventListener';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useRequest from '../useRequest';\nimport useUpdateEffect from '../useUpdateEffect';\nimport { getTargetElement } from '../utils/domTarget';\nimport { getClientHeight, getScrollHeight, getScrollTop } from '../utils/rect';\nconst useInfiniteScroll = (service, options = {}) => {\n  const {\n    target,\n    isNoMore,\n    threshold = 100,\n    reloadDeps = [],\n    manual,\n    onBefore,\n    onSuccess,\n    onError,\n    onFinally\n  } = options;\n  const [finalData, setFinalData] = useState();\n  const [loadingMore, setLoadingMore] = useState(false);\n  const noMore = useMemo(() => {\n    if (!isNoMore) return false;\n    return isNoMore(finalData);\n  }, [finalData]);\n  const {\n    loading,\n    run,\n    runAsync,\n    cancel\n  } = useRequest(lastData => __awaiter(void 0, void 0, void 0, function* () {\n    const currentData = yield service(lastData);\n    if (!lastData) {\n      setFinalData(currentData);\n    } else {\n      setFinalData(Object.assign(Object.assign({}, currentData), {\n        // @ts-ignore\n        list: [...lastData.list, ...currentData.list]\n      }));\n    }\n    return currentData;\n  }), {\n    manual,\n    onFinally: (_, d, e) => {\n      setLoadingMore(false);\n      onFinally === null || onFinally === void 0 ? void 0 : onFinally(d, e);\n    },\n    onBefore: () => onBefore === null || onBefore === void 0 ? void 0 : onBefore(),\n    onSuccess: d => {\n      setTimeout(() => {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        scrollMethod();\n      });\n      onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(d);\n    },\n    onError: e => onError === null || onError === void 0 ? void 0 : onError(e)\n  });\n  const loadMore = () => {\n    if (noMore) return;\n    setLoadingMore(true);\n    run(finalData);\n  };\n  const loadMoreAsync = () => {\n    if (noMore) return Promise.reject();\n    setLoadingMore(true);\n    return runAsync(finalData);\n  };\n  const reload = () => run();\n  const reloadAsync = () => runAsync();\n  const scrollMethod = () => {\n    const el = getTargetElement(target);\n    if (!el) {\n      return;\n    }\n    const scrollTop = getScrollTop(el);\n    const scrollHeight = getScrollHeight(el);\n    const clientHeight = getClientHeight(el);\n    if (scrollHeight - scrollTop <= clientHeight + threshold) {\n      loadMore();\n    }\n  };\n  useEventListener('scroll', () => {\n    if (loading || loadingMore) {\n      return;\n    }\n    scrollMethod();\n  }, {\n    target\n  });\n  useUpdateEffect(() => {\n    run();\n  }, [...reloadDeps]);\n  return {\n    data: finalData,\n    loading: !loadingMore && loading,\n    loadingMore,\n    noMore,\n    loadMore: useMemoizedFn(loadMore),\n    loadMoreAsync: useMemoizedFn(loadMoreAsync),\n    reload: useMemoizedFn(reload),\n    reloadAsync: useMemoizedFn(reloadAsync),\n    mutate: setFinalData,\n    cancel\n  };\n};\nexport default useInfiniteScroll;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}