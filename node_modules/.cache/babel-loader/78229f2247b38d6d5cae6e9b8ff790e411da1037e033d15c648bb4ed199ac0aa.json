{"ast":null,"code":"import { __rest } from \"tslib\";\nimport useCreation from '../../useCreation';\nimport useLatest from '../../useLatest';\nimport useMemoizedFn from '../../useMemoizedFn';\nimport useMount from '../../useMount';\nimport useUnmount from '../../useUnmount';\nimport useUpdate from '../../useUpdate';\nimport Fetch from './Fetch';\nfunction useRequestImplement(service) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  let plugins = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n  const {\n      manual = false\n    } = options,\n    rest = __rest(options, [\"manual\"]);\n  const fetchOptions = Object.assign({\n    manual\n  }, rest);\n  const serviceRef = useLatest(service);\n  const update = useUpdate();\n  const fetchInstance = useCreation(() => {\n    const initState = plugins.map(p => {\n      var _a;\n      return (_a = p === null || p === void 0 ? void 0 : p.onInit) === null || _a === void 0 ? void 0 : _a.call(p, fetchOptions);\n    }).filter(Boolean);\n    return new Fetch(serviceRef, fetchOptions, update, Object.assign({}, ...initState));\n  }, []);\n  fetchInstance.options = fetchOptions;\n  // run all plugins hooks\n  fetchInstance.pluginImpls = plugins.map(p => p(fetchInstance, fetchOptions));\n  useMount(() => {\n    if (!manual) {\n      // useCachePlugin can set fetchInstance.state.params from cache when init\n      const params = fetchInstance.state.params || options.defaultParams || [];\n      // @ts-ignore\n      fetchInstance.run(...params);\n    }\n  });\n  useUnmount(() => {\n    fetchInstance.cancel();\n  });\n  return {\n    loading: fetchInstance.state.loading,\n    data: fetchInstance.state.data,\n    error: fetchInstance.state.error,\n    params: fetchInstance.state.params || [],\n    cancel: useMemoizedFn(fetchInstance.cancel.bind(fetchInstance)),\n    refresh: useMemoizedFn(fetchInstance.refresh.bind(fetchInstance)),\n    refreshAsync: useMemoizedFn(fetchInstance.refreshAsync.bind(fetchInstance)),\n    run: useMemoizedFn(fetchInstance.run.bind(fetchInstance)),\n    runAsync: useMemoizedFn(fetchInstance.runAsync.bind(fetchInstance)),\n    mutate: useMemoizedFn(fetchInstance.mutate.bind(fetchInstance))\n  };\n}\nexport default useRequestImplement;","map":{"version":3,"names":["__rest","useCreation","useLatest","useMemoizedFn","useMount","useUnmount","useUpdate","Fetch","useRequestImplement","service","options","arguments","length","undefined","plugins","manual","rest","fetchOptions","Object","assign","serviceRef","update","fetchInstance","initState","map","p","_a","onInit","call","filter","Boolean","pluginImpls","params","state","defaultParams","run","cancel","loading","data","error","bind","refresh","refreshAsync","runAsync","mutate"],"sources":["/Users/mac/node_modules/ahooks/es/useRequest/src/useRequestImplement.js"],"sourcesContent":["import { __rest } from \"tslib\";\nimport useCreation from '../../useCreation';\nimport useLatest from '../../useLatest';\nimport useMemoizedFn from '../../useMemoizedFn';\nimport useMount from '../../useMount';\nimport useUnmount from '../../useUnmount';\nimport useUpdate from '../../useUpdate';\nimport Fetch from './Fetch';\nfunction useRequestImplement(service, options = {}, plugins = []) {\n  const {\n      manual = false\n    } = options,\n    rest = __rest(options, [\"manual\"]);\n  const fetchOptions = Object.assign({\n    manual\n  }, rest);\n  const serviceRef = useLatest(service);\n  const update = useUpdate();\n  const fetchInstance = useCreation(() => {\n    const initState = plugins.map(p => {\n      var _a;\n      return (_a = p === null || p === void 0 ? void 0 : p.onInit) === null || _a === void 0 ? void 0 : _a.call(p, fetchOptions);\n    }).filter(Boolean);\n    return new Fetch(serviceRef, fetchOptions, update, Object.assign({}, ...initState));\n  }, []);\n  fetchInstance.options = fetchOptions;\n  // run all plugins hooks\n  fetchInstance.pluginImpls = plugins.map(p => p(fetchInstance, fetchOptions));\n  useMount(() => {\n    if (!manual) {\n      // useCachePlugin can set fetchInstance.state.params from cache when init\n      const params = fetchInstance.state.params || options.defaultParams || [];\n      // @ts-ignore\n      fetchInstance.run(...params);\n    }\n  });\n  useUnmount(() => {\n    fetchInstance.cancel();\n  });\n  return {\n    loading: fetchInstance.state.loading,\n    data: fetchInstance.state.data,\n    error: fetchInstance.state.error,\n    params: fetchInstance.state.params || [],\n    cancel: useMemoizedFn(fetchInstance.cancel.bind(fetchInstance)),\n    refresh: useMemoizedFn(fetchInstance.refresh.bind(fetchInstance)),\n    refreshAsync: useMemoizedFn(fetchInstance.refreshAsync.bind(fetchInstance)),\n    run: useMemoizedFn(fetchInstance.run.bind(fetchInstance)),\n    runAsync: useMemoizedFn(fetchInstance.runAsync.bind(fetchInstance)),\n    mutate: useMemoizedFn(fetchInstance.mutate.bind(fetchInstance))\n  };\n}\nexport default useRequestImplement;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}